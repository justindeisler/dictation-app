---
phase: 01-foundation-settings
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DictationApp/DictationApp.xcodeproj/project.pbxproj
  - DictationApp/Package.swift
  - DictationApp/Info.plist
  - DictationApp/DictationApp.entitlements
  - DictationApp/Sources/App/AppDelegate.swift
  - DictationApp/Sources/App/DictationAppApp.swift
autonomous: true

must_haves:
  truths:
    - "App launches without appearing in dock"
    - "App shows icon in menu bar"
    - "App builds and runs without errors"
  artifacts:
    - path: "DictationApp/DictationApp.xcodeproj"
      provides: "Xcode project with correct configuration"
    - path: "DictationApp/Info.plist"
      provides: "LSUIElement=true for menu bar only"
      contains: "LSUIElement"
    - path: "DictationApp/Sources/App/AppDelegate.swift"
      provides: "NSStatusItem menu bar setup"
      min_lines: 30
  key_links:
    - from: "DictationApp/Sources/App/DictationAppApp.swift"
      to: "AppDelegate"
      via: "@NSApplicationDelegateAdaptor"
      pattern: "NSApplicationDelegateAdaptor.*AppDelegate"
---

<objective>
Create Xcode project foundation with menu bar presence and no dock icon.

Purpose: Establishes the base project structure that all Phase 1 functionality builds upon. Without this foundation, no other work can proceed.

Output: Working macOS app that appears only in menu bar with basic menu structure.
</objective>

<execution_context>
@/Users/justindeisler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/justindeisler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-settings/01-RESEARCH.md
@.planning/phases/01-foundation-settings/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Xcode project with Swift Package Manager</name>
  <files>
    DictationApp/DictationApp.xcodeproj/project.pbxproj
    DictationApp/Package.swift
    DictationApp/Info.plist
    DictationApp/DictationApp.entitlements
  </files>
  <action>
Create new macOS App project named "DictationApp" in the project root:

1. Create Xcode project using command line or manual setup:
   - Product Name: DictationApp
   - Organization Identifier: com.dictationapp (or user's preference)
   - Interface: SwiftUI
   - Language: Swift
   - Deployment Target: macOS 14.0

2. Configure Info.plist:
   - Add `LSUIElement` = `true` (Boolean) — hides dock icon
   - Add `NSMicrophoneUsageDescription` = "DictationApp records audio to transcribe your speech."
   - Add `NSAppleEventsUsageDescription` = "DictationApp needs to paste transcribed text into other applications."

3. Configure DictationApp.entitlements:
   - Do NOT add `com.apple.security.app-sandbox` (non-sandboxed app per research decision)
   - Add `com.apple.security.automation.apple-events` = true

4. Add KeychainAccess dependency via Swift Package Manager:
   - URL: https://github.com/kishikawakatsumi/KeychainAccess
   - Version: 4.2.2 or later (Up to Next Major Version)

5. Set build settings:
   - SWIFT_VERSION = 6.0
   - MACOSX_DEPLOYMENT_TARGET = 14.0
  </action>
  <verify>
- `ls -la DictationApp/` shows project structure
- `cat DictationApp/Info.plist | grep -A1 LSUIElement` shows `true`
- Xcode project opens without errors: `open DictationApp/DictationApp.xcodeproj`
  </verify>
  <done>
Xcode project exists with correct Info.plist (LSUIElement=true), entitlements (no sandbox), and KeychainAccess dependency added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement AppDelegate with NSStatusItem menu bar</name>
  <files>
    DictationApp/Sources/App/AppDelegate.swift
    DictationApp/Sources/App/DictationAppApp.swift
  </files>
  <action>
Create AppDelegate.swift with NSStatusItem setup per research patterns:

```swift
import AppKit
import SwiftUI

class AppDelegate: NSObject, NSApplicationDelegate {
    var statusItem: NSStatusItem?
    var settingsWindowController: NSWindowController?

    func applicationDidFinishLaunching(_ notification: Notification) {
        setupMenuBar()
    }

    private func setupMenuBar() {
        statusItem = NSStatusBar.system.statusItem(withLength: NSStatusItem.variableLength)

        if let button = statusItem?.button {
            // User decision: SF Symbol for icon (waveform per research)
            button.image = NSImage(systemSymbolName: "waveform", accessibilityDescription: "Dictation")
            button.image?.isTemplate = true  // Adapts to light/dark mode
        }

        let menu = NSMenu()

        // Settings (Cmd+,)
        menu.addItem(NSMenuItem(title: "Settings...", action: #selector(openSettings), keyEquivalent: ","))
        menu.addItem(NSMenuItem.separator())

        // About
        menu.addItem(NSMenuItem(title: "About DictationApp", action: #selector(showAbout), keyEquivalent: ""))

        // Check for Updates (placeholder per user's Claude discretion)
        menu.addItem(NSMenuItem(title: "Check for Updates...", action: #selector(checkForUpdates), keyEquivalent: ""))
        menu.addItem(NSMenuItem.separator())

        // Recent transcriptions (placeholder for Phase 3)
        let recentMenu = NSMenu()
        recentMenu.addItem(NSMenuItem(title: "No recent transcriptions", action: nil, keyEquivalent: ""))
        let recentItem = NSMenuItem(title: "Recent Transcriptions", action: nil, keyEquivalent: "")
        recentItem.submenu = recentMenu
        menu.addItem(recentItem)
        menu.addItem(NSMenuItem.separator())

        // Shortcuts info
        menu.addItem(NSMenuItem(title: "Keyboard Shortcuts", action: #selector(showShortcuts), keyEquivalent: ""))
        menu.addItem(NSMenuItem.separator())

        // Launch at login toggle
        let launchToggle = NSMenuItem(title: "Launch at Login", action: #selector(toggleLaunchAtLogin(_:)), keyEquivalent: "")
        launchToggle.state = .off  // Will be updated in Plan 03
        menu.addItem(launchToggle)
        menu.addItem(NSMenuItem.separator())

        // Quit (Cmd+Q)
        menu.addItem(NSMenuItem(title: "Quit DictationApp", action: #selector(quit), keyEquivalent: "q"))

        statusItem?.menu = menu
    }

    @objc func openSettings() {
        // Placeholder - implemented in Plan 02
        print("Settings clicked")
    }

    @objc func showAbout() {
        NSApp.orderFrontStandardAboutPanel(nil)
        NSApp.activate(ignoringOtherApps: true)
    }

    @objc func checkForUpdates() {
        // Placeholder - deferred to future enhancement
        let alert = NSAlert()
        alert.messageText = "Check for Updates"
        alert.informativeText = "You're running the latest version."
        alert.runModal()
    }

    @objc func showShortcuts() {
        let alert = NSAlert()
        alert.messageText = "Keyboard Shortcuts"
        alert.informativeText = "Option + Space: Toggle recording\n\nStart dictating and your words will appear in the active text field."
        alert.runModal()
    }

    @objc func toggleLaunchAtLogin(_ sender: NSMenuItem) {
        // Placeholder - implemented in Plan 03
        sender.state = sender.state == .on ? .off : .on
    }

    @objc func quit() {
        NSApp.terminate(nil)
    }
}
```

Update DictationAppApp.swift to use AppDelegate:

```swift
import SwiftUI

@main
struct DictationAppApp: App {
    @NSApplicationDelegateAdaptor(AppDelegate.self) var appDelegate

    var body: some Scene {
        // No WindowGroup - menu bar only app
        Settings {
            EmptyView()
        }
    }
}
```

Ensure source files are in correct directory structure:
- DictationApp/Sources/App/AppDelegate.swift
- DictationApp/Sources/App/DictationAppApp.swift
  </action>
  <verify>
- Build project: `xcodebuild -project DictationApp/DictationApp.xcodeproj -scheme DictationApp build`
- Run app and verify: no dock icon, waveform icon in menu bar, clicking shows menu with all items
  </verify>
  <done>
App launches with menu bar icon (waveform SF Symbol), no dock icon visible, menu shows all items (Settings, About, Check for Updates, Recent Transcriptions, Keyboard Shortcuts, Launch at Login, Quit).
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `xcodebuild -project DictationApp/DictationApp.xcodeproj -scheme DictationApp build` exits 0
2. App launches from build output or Xcode
3. No dock icon appears (LSUIElement working)
4. Menu bar icon visible (waveform symbol)
5. Click menu bar icon → dropdown menu appears
6. Menu contains: Settings, About, Check for Updates, Recent Transcriptions, Keyboard Shortcuts, Launch at Login, Quit
7. Quit menu item terminates app
8. About shows standard about panel
</verification>

<success_criteria>
- Xcode project created with Swift 6.0, macOS 14.0 target
- Info.plist contains LSUIElement=true
- KeychainAccess dependency added via SPM
- App runs without appearing in dock
- Menu bar icon (waveform) is visible and clickable
- All menu items present per user decisions from CONTEXT.md
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-settings/01-01-SUMMARY.md`
</output>
